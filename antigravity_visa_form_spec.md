# Antigravity 用 指示書 / 仕様書

> プロジェクト名: 「留学ビザ申請用 学生スマホ入力フォーム（新規・更新対応）」
> 対象IDE: Google Antigravity（Gemini 3 ベースのエージェント IDE）

この文書は、Google Antigravity 上で AI エージェントに実装を任せるための **仕様書兼プロンプト** です。Antigravity のエージェントに対しては、次のように指示します:

> 「このリポジトリの `specs/student-visa-intake.md` を読み込み、この仕様に沿って MVP を実装してください。」

---

## 1. プロジェクト概要

### 1.1 目的

外国人留学生がスマホから日本語学校にビザ申請情報を送信するための **ステップ式フォーム Web アプリ** を実装する。

- 新規: 在留資格認定証明書（COE）取得用の情報を収集
- 更新: 在留期間更新用の情報を収集
- 学生側の入力ミス・漏れを減らす
- 学校側が入管様式（Excel/PDF）に転記しやすい構造にする

### 1.2 想定ユーザー

- 日本語学校へ入学予定 or 在籍中の留学生
- スマホ（縦画面）利用が前提
- 日本語をある程度読める前提だが、将来は多言語対応可能な構造にしておく

### 1.3 技術スタック（希望）

- フレームワーク: Next.js（最新の App Router） + TypeScript
- UI ライブラリ: React + Tailwind CSS
- フォーム管理: React Hook Form または同等のバリデーションしやすいライブラリ
- ビルド: SPA ではなく SSR/CSR 混在でも良いが、まずはシンプルな実装を優先
- バックエンド: 今回の MVP では「ローカル状態」でよい

※ Antigravity に対しては、「Next.js + TypeScript + Tailwind で実装する」方針を守るように伝えること。

---

## 2. 画面フロー

### 2.1 全体フロー

1. **ログイン画面**（Step 0）
2. **申請区分選択画面**（新規 or 更新）
3. **新規フロー or 更新フロー** のステップ式フォーム
4. **書類アップロード状況確認画面**
5. **入力内容確認 & 提出画面**
6. **完了画面**

画面上部にはステップインジケーター（例: 「ステップ 3 / 10」）を表示する。

### 2.2 ナビゲーション要件

- 各ステップの下部に「戻る」「次へ」ボタン
- 必須項目がすべて入力済みになるまで「次へ」は disabled
- 任意項目が未入力でも「次へ」に進める
- ブラウザバックでフォーム状態が消えないよう、最低限クライアント側状態で保持

---

## 3. 申請区分ごとのステップ構成

### 3.1 共通 Step 0: ログイン画面

**目的**: ユーザー識別と途中保存を可能にする

- メールアドレス（必須）
- パスワード（必須）
- ログインボタン
- 「パスワードを忘れた方はこちら」リンク（ダミーで OK）
- 「新規登録はこちら」リンク（今回は未実装でもよいが、見た目は用意）

### 3.2 共通 Step 1: 申請区分選択

**目的**: 以降のステップ構成を分岐させる

- ラジオボタン:
  - 「日本へ新しく留学する（COE 取得）」
  - 「日本に滞在中で、在留期間を更新する」
- どちらかが選択されるまで「次へ」は disabled

---

## 4. 新規（COE）フローのステップ詳細

> 新規フローはおおよそ 10 ステップ構成とする。画面数はスマホでの操作性を優先し、1 画面あたりの項目数を絞る。

### Step N1: 基本情報（必須）

項目（すべて必須）:

- 氏名（ローマ字）
- 氏名（母国語）
- 生年月日（カレンダー or セレクト）
- 国籍（プルダウン）
- 本国の住所（テキスト）
- 本国の電話番号（国番号＋番号）
- 本人メールアドレス

バリデーション:

- メール形式チェック
- 電話番号は数字＋記号のみ許容

### Step N2: パスポート情報（必須）

項目:

- パスポート番号
- 発行日
- 有効期限
- パスポート写真ページのファイルアップロード

バリデーション:

- 有効期限が発行日より後であること
- アップロードは必須、画像 or PDF に限定

### Step N3: 家族情報・緊急連絡先

項目:

- 父の氏名 / 生年月日 / 職業 / 住所
- 母の氏名 / 生年月日 / 職業 / 住所
- 緊急連絡先（氏名・続柄・電話番号）

バリデーション:

- 緊急連絡先は必須

### Step N4: 日本語学習歴

項目:

- 学習機関名
- 学習期間（開始〜終了）
- 総学習時間（数値）
- 日本語学習証明書ファイル
- 任意: JLPT/NAT/J.TEST 等のスコア & 証明書

バリデーション:

- 学習機関名・期間・時間・証明書は必須

### Step N5: 学歴

項目:

- 最終学校名
- 卒業年
- 所在地（国）
- 卒業証明書
- 成績証明書

バリデーション:

- 上記すべて必須

### Step N6: 職歴（任意）

項目（任意）:

- 会社名
- 在籍期間
- 業務内容

→ 全部空でも「次へ」に進める

### Step N7: 渡航歴 / 在留歴

項目:

- 過去の日本渡航歴の有無（必須）
  - 「あり」なら、渡航年月日・目的・滞在期間
- 過去の在留資格申請歴（不許可歴含む）の有無（必須）
  - 「あり」なら、その概要

### Step N8: 留学目的・進路

項目（必須）:

- なぜ日本に留学したいか（テキスト）
- この学校を選んだ理由（テキスト）
- 卒業後の進路（進学 / 就職 / 未定）

バリデーション:

- テキストは最低文字数（例: 50 文字以上）を設定

### Step N9: 経費支弁者情報

項目（必須）:

- 経費支弁者の種別（父 / 母 / 本人 / その他）
- 氏名
- 電話番号
- 住所
- 職業
- 勤務先名
- 年間収入（数値）
- 残高証明ファイル
- 通帳 6 ヶ月分ファイル
- 経費支弁書ファイル

### Step N10: 在留中の生活計画

項目（必須）:

- 予定住所（寮 / アパートなど、未定でも「未定」と入力させる）
- 生活費負担者（本人 / 家族）
- アルバイト予定の有無
  - 「あり」なら、簡単な理由入力

---

## 5. 更新フローのステップ構成（概要）

更新の場合は、必須項目が少ないショートフローとする。

### Step U1: 基本情報

- 氏名 / 生年月日 / 国籍
- 現住所（日本）
- 電話番号
- メールアドレス
- 在留カード番号
- 在留期限
- パスポート番号 & 有効期限

### Step U2: 生活状況

- 現住所
- 家賃
- 生活費負担者

### Step U3: アルバイト情報

- アルバイトの有無
- 有りの場合:
  - 勤務先名
  - 住所
  - 週の勤務時間
  - 月収
  - 給与明細アップロード

### Step U4: 経費支弁者（必要に応じて）

- 経費支弁者の情報（新規と同様だが簡略版でよい）

### Step U5: 書類アップロード確認

- 必須書類の提出状況を一覧形式で表示（新規の STEP11 と同イメージ）

### Step U6: 入力内容確認 & 提出

---

## 6. 書類アップロード確認画面（共通設計）

目的:

- これまでの各ステップでアップロード済みの書類を一覧で確認
- 不足があればここから追加アップロード or 差し替え

表示仕様:

- 各必須書類について「提出済み / 未提出」をアイコンとラベルで表示
- 「差し替える」「追加する」ボタンで再アップロード可能

---

## 7. バリデーションポリシー

### 7.1 共通

- 必須項目が空の場合はエラー表示し、「次へ」ボタンを無効化
- メール・電話番号・日付は形式チェック
- 数値項目（年間収入・学習時間など）は数値型

### 7.2 エラー表示

- 項目の直下に小さく赤字でエラーメッセージを表示
- 画面上部にも「未入力の必須項目があります」と簡易メッセージ

---

## 8. UI / UX ガイドライン

- スマホ縦画面最適化（幅 375px 程度を想定）
- 1 画面あたりの入力項目は 5〜7 個以内に抑える
- 「ステップ X / Y」を画面上部に表示
- プライマリボタンは画面下部に固定（Next.js + Tailwind で固定フッター風）
- 余白を多めにとり、freee / SmartHR 風のシンプルな UI

---

## 9. データモデル（概略）

実装時に Antigravity のエージェントが Prisma 等を使えるよう、概略のエンティティ構造を示す。

### 9.1 Entities

- Applicant
  - id, name\_romaji, name\_native, nationality, birth\_date, home\_address, home\_phone, email, etc.
- Passport
  - number, issue\_date, expiry\_date, scan\_url
- FamilyMember
  - applicant\_id, relation, name, birth\_date, occupation, address, phone
- JapaneseStudy
  - institution\_name, period\_start, period\_end, total\_hours, proof\_file
- Education
  - school\_name, graduation\_year, country, diploma\_file, transcript\_file
- Sponsor
  - applicant\_id, relation, name, phone, address, occupation, employer, annual\_income, balance\_proof\_file, bank\_statement\_file, sponsor\_letter\_file
- PartTimeJob (更新用)
  - employer\_name, address, weekly\_hours, monthly\_income, payslip\_file

※ 正規の DB 設計やマイグレーションは Antigravity 側に委ねてよいが、この構造を尊重するように指示する。

---

## 10. 実装タスクの優先順位（Antigravity 用）

Antigravity に対しては、次の順序でタスクを進めるように依頼する。

1. Next.js + TypeScript + Tailwind のプロジェクトを新規作成
2. グローバルなレイアウト: ヘッダー（ロゴ）、フッター（著作権表示）、ステップインジケータ
3. ログイン画面 + ダミー認証ロジック（フロント側だけで OK）
4. 新規フローのステップ式フォーム（バリデーション含む）
5. 更新フローのステップ式フォーム
6. 書類アップロード確認画面
7. 入力内容確認 & 完了画面

